<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pok√©mon Village</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            font-family: monospace;
            overflow: hidden;
        }

        #game {
            background: #fff;
            border: 4px solid #333;
            position: relative;
        }

        canvas { 
            display: block;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            width: 100%;
            max-width: 640px;
            height: auto;
        }

        #controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: grid;
            grid-template-columns: repeat(3, 70px);
            gap: 8px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 12px;
            border: 3px solid #555;
        }

        .btn {
            width: 70px;
            height: 70px;
            background: linear-gradient(145deg, #666, #444);
            border: 3px solid #222;
            border-radius: 8px;
            color: #fff;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            user-select: none;
            touch-action: manipulation;
            font-weight: bold;
        }

        .btn:active {
            background: linear-gradient(145deg, #444, #222);
            transform: scale(0.95);
        }

        .btn.empty {
            background: transparent;
            border: none;
        }

        .btn.a {
            background: linear-gradient(145deg, #f44, #c22);
            font-size: 32px;
        }

        .btn.a:active {
            background: linear-gradient(145deg, #c22, #a11);
        }

        #msg {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 500px;
            background: rgba(255,255,255,0.95);
            border: 4px solid #000;
            padding: 15px;
            display: none;
            font-size: 16px;
            color: #000;
            text-align: center;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
        }

        #msg.show { display: block; }

        @media (min-width: 700px) {
            #controls { bottom: 30px; }
        }
    </style>
</head>
<body>
    <div id="game">
        <canvas id="c" width="640" height="480"></canvas>
    </div>
    <div id="controls">
        <div class="btn empty"></div>
        <div class="btn" data-d="u">‚ñ≤</div>
        <div class="btn empty"></div>
        <div class="btn" data-d="l">‚óÑ</div>
        <div class="btn a" data-a="1">A</div>
        <div class="btn" data-d="r">‚ñ∫</div>
        <div class="btn empty"></div>
        <div class="btn" data-d="d">‚ñº</div>
        <div class="btn empty"></div>
    </div>
    <div id="msg"></div>

    <script>
        const c = document.getElementById('c');
        const ctx = c.getContext('2d');
        const msg = document.getElementById('msg');

        const T = 16; // Tile size
        const W = 40; // Map width
        const H = 30; // Map height

        // Player
        const P = { x: 20, y: 25, dir: 0, moving: false };

        // NPCs with messages
        const NPCS = [
            { x: 18, y: 10, c: '#48f', msg: 'üëã Willkommen in Herbstdorf!' },
            { x: 25, y: 15, c: '#f84', msg: 'üéì Professor: Suche versteckte Items!' },
            { x: 30, y: 20, c: '#f8f', msg: 'üßí Kind: Ich liebe Pok√©mon!' }
        ];

        // Items
        const ITEMS = [
            { x: 10, y: 5, found: false, msg: '‚ú® Superball gefunden!' },
            { x: 35, y: 28, found: false, msg: '‚≠ê Sternenst√ºck gefunden!' },
            { x: 5, y: 20, found: false, msg: 'üíé Nugget gefunden!' }
        ];

        // Map tiles: 0=grass, 1=path, 2=tree, 3=water, 4=roof-red, 5=wall, 6=door, 7=roof-blue, 8=flower
        const M = [];
        for(let y = 0; y < H; y++) {
            M[y] = [];
            for(let x = 0; x < W; x++) {
                M[y][x] = 0; // Default grass
            }
        }

        // Build world
        function build() {
            // Main roads
            for(let y = 0; y < H; y++) {
                for(let x = 18; x <= 21; x++) M[y][x] = 1;
            }
            for(let x = 0; x < W; x++) {
                M[12][x] = 1;
                M[20][x] = 1;
            }

            // River
            for(let y = 0; y < H; y++) {
                M[y][32] = 3;
                M[y][33] = 3;
            }

            // Trees border
            for(let x = 0; x < W; x++) {
                M[0][x] = 2;
                M[H-1][x] = 2;
            }
            for(let y = 0; y < H; y++) {
                M[y][0] = 2;
                M[y][W-1] = 2;
            }

            // Pok√©mon Center (red roof)
            for(let yy = 3; yy <= 7; yy++) {
                for(let xx = 17; xx <= 22; xx++) {
                    if(yy === 3) M[yy][xx] = 4; // Red roof
                    else if(yy === 7 && xx === 20) M[yy][xx] = 6; // Door
                    else M[yy][xx] = 5; // Wall
                }
            }

            // Pok√© Mart (blue roof)
            for(let yy = 8; yy <= 11; yy++) {
                for(let xx = 26; xx <= 29; xx++) {
                    if(yy === 8) M[yy][xx] = 7; // Blue roof
                    else if(yy === 11 && xx === 28) M[yy][xx] = 6;
                    else M[yy][xx] = 5;
                }
            }

            // Houses
            house(5, 5, 3, 3);
            house(10, 10, 4, 3);
            house(15, 25, 3, 3);
            house(24, 8, 3, 3);

            // Flowers
            M[10][10] = 8;
            M[15][5] = 8;
            M[22][35] = 8;
        }

        function house(y, x, w, h) {
            for(let dy = 0; dy < h; dy++) {
                for(let dx = 0; dx < w; dx++) {
                    if(dy === 0) M[y+dy][x+dx] = 4;
                    else if(dy === h-1 && dx === Math.floor(w/2)) M[y+dy][x+dx] = 6;
                    else M[y+dy][x+dx] = 5;
                }
            }
        }

        build();

        // Collision tiles
        const SOLID = [2, 3, 4, 5, 7];

        // Draw functions
        function rect(x, y, w, h, col) {
            ctx.fillStyle = col;
            ctx.fillRect(x, y, w, h);
        }

        function tile(x, y, type) {
            const px = x * T;
            const py = y * T;

            switch(type) {
                case 0: // Grass
                    rect(px, py, T, T, '#98d098');
                    rect(px+2, py+2, 4, 4, '#78b078');
                    rect(px+10, py+6, 4, 4, '#78b078');
                    break;
                case 1: // Path
                    rect(px, py, T, T, '#d8b870');
                    break;
                case 2: // Tree
                    rect(px, py, T, T, '#387038');
                    rect(px+2, py+2, T-4, T-4, '#285828');
                    ctx.fillStyle = '#184018';
                    ctx.fillRect(px+4, py+4, T-8, T-8);
                    break;
                case 3: // Water
                    rect(px, py, T, T, '#5088d0');
                    rect(px+3, py+3, 6, 6, '#70a8f0');
                    break;
                case 4: // Red roof
                    rect(px, py, T, T, '#d83038');
                    rect(px+2, py+2, T-4, T-4, '#a82028');
                    break;
                case 5: // Wall
                    rect(px, py, T, T, '#e8d8a8');
                    rect(px+4, py+4, 8, 6, '#90c8e8'); // Window
                    break;
                case 6: // Door
                    rect(px, py, T, T, '#886030');
                    rect(px+5, py+5, 6, 8, '#604020');
                    break;
                case 7: // Blue roof
                    rect(px, py, T, T, '#4878c0');
                    rect(px+2, py+2, T-4, T-4, '#3860a0');
                    break;
                case 8: // Flower
                    rect(px, py, T, T, '#98d098');
                    rect(px+6, py+6, 4, 4, '#f85090');
                    break;
            }
        }

        function draw() {
            // Clear
            ctx.fillStyle = '#98d098';
            ctx.fillRect(0, 0, c.width, c.height);

            // Map
            for(let y = 0; y < H; y++) {
                for(let x = 0; x < W; x++) {
                    tile(x, y, M[y][x]);
                }
            }

            // Items
            ITEMS.forEach(it => {
                if(!it.found) {
                    rect(it.x * T + 5, it.y * T + 5, 6, 6, '#ff0');
                }
            });

            // NPCs
            NPCS.forEach(n => {
                // Body
                rect(n.x * T + 2, n.y * T + 2, 12, 12, n.c);
                // Eyes
                rect(n.x * T + 4, n.y * T + 5, 3, 3, '#fff');
                rect(n.x * T + 9, n.y * T + 5, 3, 3, '#fff');
                rect(n.x * T + 5, n.y * T + 6, 1, 1, '#000');
                rect(n.x * T + 10, n.y * T + 6, 1, 1, '#000');
            });

            // Player
            const px = P.x * T;
            const py = P.y * T;
            
            // Body (red)
            rect(px + 2, py + 2, 12, 12, '#f83838');
            
            // Eyes
            rect(px + 4, py + 5, 3, 3, '#fff');
            rect(px + 9, py + 5, 3, 3, '#fff');
            rect(px + 5, py + 6, 1, 1, '#000');
            rect(px + 10, py + 6, 1, 1, '#000');
            
            // Backpack
            rect(px + 6, py + 10, 4, 3, '#333');
        }

        // Message
        let msgShow = false;
        function showMsg(text) {
            msg.textContent = text;
            msg.classList.add('show');
            msgShow = true;
        }

        function hideMsg() {
            msg.classList.remove('show');
            msgShow = false;
        }

        // Interaction
        function interact() {
            if(msgShow) {
                hideMsg();
                return;
            }

            // Check item
            const it = ITEMS.find(i => i.x === P.x && i.y === P.y && !i.found);
            if(it) {
                it.found = true;
                showMsg(it.msg);
                draw();
                return;
            }

            // Check NPC (adjacent)
            const dirs = [{x:0,y:-1}, {x:0,y:1}, {x:-1,y:0}, {x:1,y:0}];
            for(let d of dirs) {
                const npc = NPCS.find(n => n.x === P.x + d.x && n.y === P.y + d.y);
                if(npc) {
                    showMsg(npc.msg);
                    return;
                }
            }

            // Check buildings
            if(P.y >= 3 && P.y <= 7 && P.x >= 17 && P.x <= 22) {
                showMsg('üíä Pok√©mon Center: Deine Pok√©mon sind gesund!');
                return;
            }
            if(P.y >= 8 && P.y <= 11 && P.x >= 26 && P.x <= 29) {
                showMsg('üõí Pok√© Mart: Willkommen! Wir haben Pok√©b√§lle!');
                return;
            }

            showMsg('üí¨ Hier gibt es nichts.');
        }

        // Movement
        function move(dx, dy) {
            if(P.moving || msgShow) return;

            const nx = P.x + dx;
            const ny = P.y + dy;

            if(nx < 0 || nx >= W || ny < 0 || ny >= H) return;
            if(SOLID.includes(M[ny][nx])) return;
            if(NPCS.find(n => n.x === nx && n.y === ny)) return;

            P.moving = true;
            P.x = nx;
            P.y = ny;
            draw();

            setTimeout(() => P.moving = false, 120);
        }

        // Controls
        document.addEventListener('keydown', e => {
            if(msgShow) {
                if(['e','Enter',' '].includes(e.key)) {
                    hideMsg();
                }
                return;
            }

            switch(e.key) {
                case 'ArrowUp': case 'w': move(0, -1); break;
                case 'ArrowDown': case 's': move(0, 1); break;
                case 'ArrowLeft': case 'a': move(-1, 0); break;
                case 'ArrowRight': case 'd': move(1, 0); break;
                case 'e': case 'Enter': case ' ': interact(); break;
            }
        });

        // Touch controls
        document.querySelectorAll('.btn').forEach(b => {
            b.addEventListener('touchstart', e => {
                e.preventDefault();
                const d = b.dataset.d;
                if(d === 'u') move(0, -1);
                else if(d === 'd') move(0, 1);
                else if(d === 'l') move(-1, 0);
                else if(d === 'r') move(1, 0);
                else if(b.dataset.a) interact();
            }, {passive: false});
        });

        // Init
        draw();
        setTimeout(() => showMsg('üéÆ Willkommen in Herbstdorf! Erkunde die Stadt!'), 500);
    </script>
</body>
</html>